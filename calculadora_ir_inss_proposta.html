<script>
function parseInput(valor) {
  valor = valor.replaceAll('.', '').replace(',', '.');
  let parsed = parseFloat(valor);
  return isNaN(parsed) ? 0 : parsed;
}

function formatarMoeda(valor) {
  return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

function calcularTudo() {
  let salario = parseInput(document.getElementById("salario").value);
  let lucros = parseInput(document.getElementById("lucros").value);
  let dividendos = parseInput(document.getElementById("dividendos").value);
  let offshore = parseInput(document.getElementById("offshore").value);
  let fundos = parseInput(document.getElementById("fundos").value);
  let heranca = parseInput(document.getElementById("heranca").value);

  let inss = Math.min(salario * 0.14, 951.62);
  let base_ir = salario - inss;

  let ir_atual = base_ir <= 2112 ? 0 :
                 base_ir <= 2826.65 ? base_ir * 0.075 - 158.4 :
                 base_ir <= 3751.05 ? base_ir * 0.15 - 370.4 :
                 base_ir <= 4664.68 ? base_ir * 0.225 - 651.73 :
                 base_ir * 0.275 - 884.96;

  let ir_proposta = 0;
  if (base_ir > 5000) {
    ir_proposta += Math.min(base_ir - 5000, 2350) * 0.075;
    if (base_ir > 7350) ir_proposta += Math.min(base_ir - 7350, 2650) * 0.15;
    if (base_ir > 10000) ir_proposta += Math.min(base_ir - 10000, 10000) * 0.225;
    if (base_ir > 20000) ir_proposta += (base_ir - 20000) * 0.275;
  }

  let ir_dividendos = dividendos * 0.15;
  let ir_offshore = offshore * 0.22;
  let ir_fundos = fundos * 0.15;
  let itcmd = heranca <= 4000000 ? heranca * 0.08 : heranca * 0.16;

  let total_atual = ir_atual;
  let total_proposta = ir_proposta + ir_dividendos + ir_offshore + ir_fundos + itcmd;
  let diferenca_total = total_proposta - total_atual;

  // üîπ Novo c√°lculo do sal√°rio l√≠quido na proposta
  let novo_salario = salario - inss - ir_proposta;

  document.getElementById("resultado").innerHTML = `
    <h3>Resultado:</h3>
    <p><strong>INSS:</strong> ${formatarMoeda(inss)}</p>
    <p><strong>Imposto de Renda (modelo atual):</strong> ${formatarMoeda(ir_atual)}</p>
    <p><strong>Imposto de Renda (proposta):</strong> ${formatarMoeda(ir_proposta)}</p>
    <p><strong>Dividendos tributados (15%):</strong> ${formatarMoeda(ir_dividendos)}</p>
    <p><strong>Lucros Offshore (22%):</strong> ${formatarMoeda(ir_offshore)}</p>
    <p><strong>Fundos Exclusivos (15%):</strong> ${formatarMoeda(ir_fundos)}</p>
    <p><strong>Heran√ßa/Doa√ß√µes:</strong> ${formatarMoeda(itcmd)}</p>
    <p><strong>Diferen√ßa total de impostos:</strong> ${formatarMoeda(diferenca_total)}</p>
    
    <hr>
    <p style="font-size:18px; font-weight:bold; color:#2e7d32;">
      üí∞ Novo sal√°rio l√≠quido (com a proposta): ${formatarMoeda(novo_salario)}
    </p>
    <p><small>(Sal√°rio bruto - INSS - IR Proposta)</small></p>
  `;
}
</script>
